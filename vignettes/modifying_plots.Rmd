---
title: "Modifying Plots made with ggordiplots"
author: "John Quensen"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
# Modifying Plots made with ggordiplots

To enable further customization, all functions in this package return silently a list of the data frames used for the plots and the plots themselves These may be captured by assigning the function result to a variable. For `gg_ordiplot`, for example, get a list of the names of the items returned: 

```{r}
suppressPackageStartupMessages(library(vegan))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(ggordiplots))
data("dune")
data("dune.env")
dune.hel <- decostand(dune, method = "hellinger")
ord <- rda(dune.hel)
my.plot <- gg_ordiplot(ord, groups = dune.env$Management, hull = TRUE, spiders = TRUE, ellipse = FALSE, plot = FALSE)
names(my.plot)
```

The last object in the list is the plot itself. You can capture the plot and make modifications by adding `ggplot2` labels and themes:  

```{r}
a.plot <- my.plot$plot
a.plot + 
  theme_bw() +
  labs(color="Management", x="PCA 1", y="PCA 2", title="My Title") +
  theme(plot.title = element_text(hjust = 0.5)) # centers main title, version 2.2
```

The other items in the list are the data frames used for the plot layers:  

Item | Description
-----|------
df_ord | Point coordinates for ordination
df_mean.ord | Label coordinates
df_ellipse | Data for plotting ellipses
df_hull | Data for plotting hulls
df_spiders | Data for plotting spiders

You can check the first few lines of each data frame thus:   

```{r}
head(my.plot$df_spiders)
```

The `ggplot2` statements I used for each layer are:   

```{r, eval=FALSE}
# Basic ordination plot:
xlab <- paste("Axis", choices[1], sep = " ")
ylab <- paste("Axis", choices[2], sep = " ")
geom_point(data=df_ord, aes(x=x, y=y, color=Group), size=3) +
    xlab(xlab) + ylab(ylab)

# Plot ellispes:
geom_path(data = df_ellipse, aes(x=x, y=y, color=Group), show.legend = FALSE)

# Plot centroid labels:
geom_text(data=df_mean.ord, aes(x=x, y=y, label=Group, color=Group), show.legend = FALSE)

# Plot hulls:
geom_path(data=df_hull, aes(x=x, y=y, color=Group), show.legend = FALSE)

# Plot spiders:
geom_segment(data=df_spiders, aes(x=cntr.x, xend=x, y=cntr.y, yend=y, color=Group), show.legend = FALSE)

# Plot cluster segments:
geom_segment(data=df_segments, aes(x=x, y=y, xend=xend, yend=yend))
```

With the above information and some knowledge of `ggplot2` you can modify the plots however you wish. And to learn more, you can inspect the code by entering `gg_ordiplot` or any other function written in R (i.e. not compiled) without parentheses. As a short example, the hidden function in `vegan` for generating data for an ellipse is:  

```{r}
vegan:::veganCovEllipse
```

# gg_ordicluster

At present, `gg_ordicluster` has no provision for coloring the site points according to treatment. Lets add color according to Management. First, generate the plot as in the example, but capture the result to the variable `plot1`.    

```{r}
data("dune")
dune.bray <- vegdist(dune, method="bray")
ord <- cmdscale(dune.bray, k=nrow(dune)-1, eig=TRUE, add=TRUE)
clstr.rslt <- hclust(dune.bray, method="single")
plot1 <- gg_ordicluster(ord, clstr.rslt, plot=FALSE)
```

Now, extract the data frame for the ordination (site scores) and add a column from `dune.env` for Management. I know the samples are in the same order, so no need to check this time. Also extract the `df_segments` from `plot1`.  

```{r}
ord.data <- plot1$df_ord
data("dune.env")
ord.data$Managment <- dune.env$Management
head(ord.data)
df_segments <- plot1$df_segments
head(df_segments)
```

Now plot again, this time including color for Management. If you are not sure of the `ggplot2` commands, you can examine what was used in `gg_ordicluster` by listing the function - just enter it without parentheses.  

```{r}
plot2 <- ggplot() +
  geom_point(data=ord.data, aes(x=x, y=y, color=Managment), size=3) +
  geom_segment(data=df_segments, aes(x=x, y=y, xend=xend, yend=yend))
plot2
```

Looks like samples did not cluster well by Management. This is also evident from a cluster plot.  

```{r}
plot(clstr.rslt, labels = dune.env$Management)
```

If you use the same data, you can "mix and match" data frames and/or plots from different functions. For example, make an ordination plot with ellipses and then add the cluster segments to the plot:  

```{r}
plot3 <- gg_ordiplot(ord, groups = dune.env$Management, kind = "se", conf = 0.95, plot=FALSE)
plot3$plot +
  geom_segment(data=df_segments, aes(x=x, y=y, xend=xend, yend=yend))
```

Enjoy!

